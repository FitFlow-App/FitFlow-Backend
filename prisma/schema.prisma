// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Usuario {
  id        Int       @id @default(autoincrement())
  nombre    String
  email     String    @unique
  password  String
  rutinas   Rutina[]
  planificaciones PlanificacionSemanal[]
}

model PlanificacionSemanal {
  id          Int      @id @default(autoincrement())
  nombre      String   // Ej: "Planificación Septiembre", "Volumen 1", etc.
  numero      Int      // Número de semana (1, 2, 3...)
  usuarioId   Int
  usuario     Usuario  @relation(fields: [usuarioId], references: [id])
  dias        DiaPlanificado[]
  activa      Boolean  @default(false)
  
  @@unique([usuarioId, numero])
}

model DiaPlanificado {
  id          Int      @id @default(autoincrement())
  nombre      String   // Ej: "Lunes - Piernas", "Martes - Pecho", etc.
  diaSemana   Int      // 1: Lunes, 2: Martes, ..., 7: Domingo
  planificacionId Int
  planificacion PlanificacionSemanal @relation(fields: [planificacionId], references: [id])
  rutinaId    Int
  rutina      Rutina   @relation(fields: [rutinaId], references: [id])
  completado  Boolean  @default(false)
  fecha       DateTime? // Opcional: para tracking específico
  
  @@unique([planificacionId, diaSemana])
}

model Rutina {
  id          Int      @id @default(autoincrement())
  nombre      String
  descripcion String?
  usuarioId   Int
  usuario     Usuario  @relation(fields: [usuarioId], references: [id])
  ejercicios  RutinaEjercicio[]
  // Eliminamos la relación inversa a Dia para evitar circularidad

  DiaPlanificado DiaPlanificado[]
}

model Ejercicio {
  id          Int      @id @default(autoincrement())
  nombre      String
  descripcion String?
  musculo     String?
  rutinas     RutinaEjercicio[]
}

model RutinaEjercicio {
  id           Int       @id @default(autoincrement())
  rutinaId     Int
  ejercicioId  Int
  series       Int?
  repeticiones Int?
  peso         Float?
  rutina       Rutina    @relation(fields: [rutinaId], references: [id])
  ejercicio    Ejercicio @relation(fields: [ejercicioId], references: [id])

  @@unique([rutinaId, ejercicioId])
}

